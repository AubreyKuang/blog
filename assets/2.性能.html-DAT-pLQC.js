import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as e,o as n}from"./app-CA3Si4S1.js";const l={};function t(h,i){return n(),a("div",null,i[0]||(i[0]=[e(`<h1 id="性能分析" tabindex="-1"><a class="header-anchor" href="#性能分析"><span>性能分析</span></a></h1><p>主要是优化查询语句（主要是索引的优化）</p><h4 id="sql执行频率" tabindex="-1"><a class="header-anchor" href="#sql执行频率"><span>SQL执行频率</span></a></h4><p>以插入/删除/修改/查询为主？</p><p>增删改查的访问频次：</p><p><code>SHOW GLOBAL STATUS LIKE &#39;Com_______&#39;;</code></p><blockquote><p>7个短下划线</p></blockquote><p><img src="https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/3978/image-20230104202956896.png" alt="image-20230104202956896"></p><h4 id="慢查询日志" tabindex="-1"><a class="header-anchor" href="#慢查询日志"><span>慢查询日志</span></a></h4><p>记录所有执行时间超过指定参数<code>(long_query_time)</code>的所有sql语句的日志</p><p>MySQL的慢查询日志默认开启</p><p>查看数据库慢查询配置：<code>show variables like &#39;slow_query_log&#39;</code></p><p>如果没有开启，需要在配置文件<code>/etc/my.cnf</code>中：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">#开启MySQL慢日志查询开关</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">slow_query_log </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">#设置慢查询时间，默认为10s</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">long_query_time </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">#重启</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">systemctl </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">restart</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> mysqld</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="show-profiles" tabindex="-1"><a class="header-anchor" href="#show-profiles"><span>Show profiles</span></a></h4><p>做sql优化时，帮助我们了解时间耗费到哪</p><p>通过<code>SELECT @@have_profiling;</code>看是否支持</p><p>默认时关闭的，需要<code>SET profiling = 1;</code></p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 不同语句的耗费时间</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">show profiles;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 查询指定query_id的SQL语句各个阶段的耗时</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">show </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">profile</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> query query_id;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 不同语句的耗费时间</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">show </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> cpu </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> query query_id;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="explain" tabindex="-1"><a class="header-anchor" href="#explain"><span>explain</span></a></h4><p>不只是看执行时间，可以看到如何执行SELECT语句的信息</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 在sql查询语句前加上关键字explain/desc</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EXPLAIN </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 字段列表 </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 表名 </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 条件;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="结果-explain执行计划" tabindex="-1"><a class="header-anchor" href="#结果-explain执行计划"><span>结果：explain执行计划</span></a></h5><ul><li><p>id ：查询的序列号，执行的顺序或是操作表的顺序</p><p><strong>⚠️id越大越先执行，id相同则从上到下执行</strong></p></li><li><p>Type：连接类型，性能有好到差的连接类型为 NULL, system, const, eq_ref, ref, range, index, all</p><blockquote><p>优化的时候，尽量往前优化</p><p>不访问任何表才有可能NULL</p><p>index表示用了索引，但是对索引全部扫描</p><p>all代表全表扫描，性能低</p></blockquote></li><li><p>**Possible_key：**可能用在这张表上的索引</p></li><li><p>**key：**实际用的索引</p></li><li><p>**Key_len：**索引中使用的字节数，为索引字段的最大可能长度，不是实际使用长度；不损失精确性的前提下，长度越短越好</p></li><li><p>Rows：执行查询的行数</p><blockquote><p>MySQL认为必须要执行查询的行数，在innodb引擎的表中，是一个估计值，可能并不准确</p></blockquote></li><li><p>Filters：表示返回结果的行占需要读取行的百分比，这个数值越大越好</p></li><li><p><strong>extra</strong>：额外进行的</p></li><li><p>Select_type：查询类型，SIMPLE、SUB等</p></li></ul><p>例子：查选修了mysql课程的学生</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-sql"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> id </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> course c </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> c</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;MySQL&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> studentid </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> student_course sc </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> sc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">couseid</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- studentid</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 1</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">-- 2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> * </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> student s </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">id</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以通过嵌套合并成一条</p><p>在前面加 <code>explain</code></p>`,28)]))}const r=s(l,[["render",t]]),d=JSON.parse(`{"path":"/cs/database/mysql/%F0%9F%93%93%203%20%E7%B4%A2%E5%BC%95/2.%E6%80%A7%E8%83%BD.html","title":"性能分析","lang":"en-US","frontmatter":{"description":"性能分析 主要是优化查询语句（主要是索引的优化） SQL执行频率 以插入/删除/修改/查询为主？ 增删改查的访问频次： SHOW GLOBAL STATUS LIKE 'Com_______'; 7个短下划线 image-20230104202956896 慢查询日志 记录所有执行时间超过指定参数(long_query_time)的所有sql语句的日志...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"性能分析\\",\\"image\\":[\\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/3978/image-20230104202956896.png\\"],\\"dateModified\\":\\"2023-04-26T09:43:18.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Aubrey\\",\\"url\\":\\"https://github.com/aubreykuang\\"}]}"],["meta",{"property":"og:url","content":"https://aubreykuang.github.io/blog/blog/cs/database/mysql/%F0%9F%93%93%203%20%E7%B4%A2%E5%BC%95/2.%E6%80%A7%E8%83%BD.html"}],["meta",{"property":"og:site_name","content":"Aubrey's Blog"}],["meta",{"property":"og:title","content":"性能分析"}],["meta",{"property":"og:description","content":"性能分析 主要是优化查询语句（主要是索引的优化） SQL执行频率 以插入/删除/修改/查询为主？ 增删改查的访问频次： SHOW GLOBAL STATUS LIKE 'Com_______'; 7个短下划线 image-20230104202956896 慢查询日志 记录所有执行时间超过指定参数(long_query_time)的所有sql语句的日志..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/3978/image-20230104202956896.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2023-04-26T09:43:18.000Z"}],["meta",{"property":"article:modified_time","content":"2023-04-26T09:43:18.000Z"}]]},"git":{"createdTime":1672889300000,"updatedTime":1682502198000,"contributors":[{"name":"KoryKL","username":"KoryKL","email":"1274994508@qq.com","commits":3,"url":"https://github.com/KoryKL"}]},"readingTime":{"minutes":2.08,"words":625},"filePathRelative":"cs/database/mysql/📓 3 索引/2.性能.md","excerpt":"\\n<p>主要是优化查询语句（主要是索引的优化）</p>\\n<h4>SQL执行频率</h4>\\n<p>以插入/删除/修改/查询为主？</p>\\n<p>增删改查的访问频次：</p>\\n<p><code>SHOW GLOBAL STATUS LIKE 'Com_______';</code></p>\\n<blockquote>\\n<p>7个短下划线</p>\\n</blockquote>\\n<p><img src=\\"https://xingqiu-tuchuang-1256524210.cos.ap-shanghai.myqcloud.com/3978/image-20230104202956896.png\\" alt=\\"image-20230104202956896\\"></p>","autoDesc":true}`);export{r as comp,d as data};
